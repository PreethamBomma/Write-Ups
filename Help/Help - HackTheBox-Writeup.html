<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Help — HackTheBox Writeup</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Help — HackTheBox Writeup</h1>
</header>
<section data-field="subtitle" class="p-summary">
Help retires this week, its one of the easier machines,slightly frustrating but I liked it a lot as it forced to read the source code…
</section>
<section data-field="body" class="e-content">
<section name="4aac" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c4b3" id="c4b3" class="graf graf--h3 graf--leading graf--title"><strong class="markup--strong markup--h3-strong">Help — HackTheBox Writeup</strong></h3><p name="e00a" id="e00a" class="graf graf--p graf-after--h3">Help retires this week, its one of the easier machines,slightly frustrating but I liked it a lot as it forced to read the source code. This box included getting a reverse shell from the webserver via submit ticket option and then kernel exploit to root it.</p><figure name="1c86" id="1c86" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 449px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 64.1%;"></div><img class="graf-image" data-image-id="1*qjAKzCcFsrbJv-XTYjlGAA.png" data-width="735" data-height="471" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*qjAKzCcFsrbJv-XTYjlGAA.png"></div></figure><h4 name="1108" id="1108" class="graf graf--h4 graf-after--figure">Let’s jump in.</h4><h3 name="3906" id="3906" class="graf graf--h3 graf-after--h4"><strong class="markup--strong markup--h3-strong">Enumeration and Recon</strong></h3><p name="cbe0" id="cbe0" class="graf graf--p graf-after--h3">As always, lets start with an <strong class="markup--strong markup--p-strong">nmap</strong> scan</p><figure name="e628" id="e628" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 286px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.8%;"></div><img class="graf-image" data-image-id="1*leXH8GVWjKm9TDjLWdiJsA.png" data-width="1168" data-height="477" src="https://cdn-images-1.medium.com/max/800/1*leXH8GVWjKm9TDjLWdiJsA.png"></div><figcaption class="imageCaption"><strong class="markup--strong markup--figure-strong">NMAP SCAN</strong></figcaption></figure><p name="a212" id="a212" class="graf graf--p graf-after--figure">Looking at the results,</p><blockquote name="105e" id="105e" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">We see that ports 22, 80 and 3000 are open</em></strong></blockquote><blockquote name="5b0b" id="5b0b" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">Port 22 —</em></strong> <strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">OpenSSH</em></strong></blockquote><blockquote name="069e" id="069e" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">80 — Apache Server</em></strong></blockquote><blockquote name="58de" id="58de" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">3000 — Node.js Express framework ( looks interesting </em>)</strong></blockquote><p name="22fe" id="22fe" class="graf graf--p graf-after--blockquote">Looking at the 80 port, we see that its a default page of Apache2 server.</p><p name="ec2e" id="ec2e" class="graf graf--p graf-after--p">Running gobuster on port 80, comes up with an interesting directory</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="6354" id="6354" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 266px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 25.8%;"></div><img class="graf-image" data-image-id="1*pUjOuVMn5P6BFYvA4_ekGA.png" data-width="1719" data-height="443" src="https://cdn-images-1.medium.com/max/1200/1*pUjOuVMn5P6BFYvA4_ekGA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="e97b" id="e97b" class="graf graf--p graf-after--figure">Lets check what we’ve got at <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">http://10.10.10.121/support</em></strong>.</p><figure name="f664" id="f664" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 318px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.4%;"></div><img class="graf-image" data-image-id="1*PiaZgoxvNzoepfvg9jbKcw.png" data-width="1743" data-height="791" src="https://cdn-images-1.medium.com/max/800/1*PiaZgoxvNzoepfvg9jbKcw.png"></div></figure><blockquote name="ed1f" id="ed1f" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">Its a HelpDeskZ application, a quick google search says</em> <br>HelpDeskZ is a free PHP based software which allows you to manage your site’s support with a web-based support ticket system.</strong></blockquote><p name="2ce9" id="2ce9" class="graf graf--p graf-after--blockquote">We have a login option and an option to submit a ticket. Lets try to submit a ticket.</p><figure name="8db9" id="8db9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 671px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 95.8%;"></div><img class="graf-image" data-image-id="1*bCogAUQPzvUvfwphun638Q.png" data-width="836" data-height="801" src="https://cdn-images-1.medium.com/max/800/1*bCogAUQPzvUvfwphun638Q.png"></div></figure><p name="f123" id="f123" class="graf graf--p graf-after--figure">Page says <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">php </em></strong>file is not allowed ( filter bypass may be ).</p><figure name="ba83" id="ba83" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 140px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 20%;"></div><img class="graf-image" data-image-id="1*TTCSEbwLnm0T5qj1mucXig.png" data-width="1017" data-height="203" src="https://cdn-images-1.medium.com/max/800/1*TTCSEbwLnm0T5qj1mucXig.png"></div></figure><p name="511f" id="511f" class="graf graf--p graf-after--figure">One more crucial point here is to find the location to where the files are uploaded to. Lets have a look at the code as its an open source application.</p><p name="94ca" id="94ca" class="graf graf--p graf-after--p"><a href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" data-href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php</a></p><div name="2596" id="2596" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" data-href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php"><strong class="markup--strong markup--mixtapeEmbed-strong">evolutionscript/HelpDeskZ-1.0</strong><br><em class="markup--em markup--mixtapeEmbed-em">HelpDeskZ v1.0. Contribute to evolutionscript/HelpDeskZ-1.0 development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fcd43c02820d5e7e6815c630ac4cd947" data-thumbnail-img-id="0*Tc6ETNKIYbKiZlqV" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*Tc6ETNKIYbKiZlqV);"></a></div><figure name="cf11" id="cf11" class="graf graf--figure graf-after--mixtapeEmbed"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 425px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 60.699999999999996%;"></div><img class="graf-image" data-image-id="1*SIP7RmLbBU92jeQjDXxurg.png" data-width="1412" data-height="857" src="https://cdn-images-1.medium.com/max/800/1*SIP7RmLbBU92jeQjDXxurg.png"></div></figure><blockquote name="be95" id="be95" class="graf graf--blockquote graf-after--figure">Looking at the code, we see that an md5 in run on the uploaded filename with the <strong class="markup--strong markup--blockquote-strong">time() </strong>function<strong class="markup--strong markup--blockquote-strong"> </strong>appended to it. And although, we see an error message saying file type is not allowed. But its actually getting uploaded and what we see in just an error message after uploading. ( Nice!!! )</blockquote><p name="e667" id="e667" class="graf graf--p graf-after--blockquote">But the Server is in another timezone<strong class="markup--strong markup--p-strong">( GMT ) </strong>. So I had to convert the server response time to epoch as, php time() <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">function returns the current time measured in the number of seconds since the Unix Epoch.</em></strong></p><p name="d95f" id="d95f" class="graf graf--p graf-after--p">What I did here was just checked the response header from network tab after clicking submit button in browser( too lazy to intercept the request in Burp ).</p><figure name="49e6" id="49e6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 217px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.1%;"></div><img class="graf-image" data-image-id="1*wa8C9r8JABvRpNxgom1Eew.png" data-width="1903" data-height="591" src="https://cdn-images-1.medium.com/max/800/1*wa8C9r8JABvRpNxgom1Eew.png"></div></figure><p name="1c8f" id="1c8f" class="graf graf--p graf-after--figure">There it is,. <strong class="markup--strong markup--p-strong">07 Jun 2019 05:52:14 GMT </strong>is the server response time. It’s corresponding epoch is <strong class="markup--strong markup--p-strong">1559886734.</strong></p><p name="fb79" id="fb79" class="graf graf--p graf-after--p">I did the conversion using <a href="https://www.epochconverter.com/" data-href="https://www.epochconverter.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">https://www.epochconverter.com/</em></strong></a></p><p name="c690" id="c690" class="graf graf--p graf-after--p">Awesome. We got the timestamp and the upload directory. Forgot to mention, I have uploaded a phpshell and yes, lets get our shell.</p><figure name="fb0e" id="fb0e" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 574px; max-height: 161px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 28.000000000000004%;"></div><img class="graf-image" data-image-id="1*-EKZAQP5H0UwfL87cAAA1g.png" data-width="574" data-height="161" src="https://cdn-images-1.medium.com/max/800/1*-EKZAQP5H0UwfL87cAAA1g.png"></div></figure><p name="1df2" id="1df2" class="graf graf--p graf-after--figure">Here “<strong class="markup--strong markup--p-strong">phpshell.php</strong>” is our filename and appended to it is the server response time in Epoch.</p><p name="80d2" id="80d2" class="graf graf--p graf-after--p">Our file is uploaded to <strong class="markup--strong markup--p-strong">http://&lt;HelpDeskBaseUrl&gt;/uploads/tickets/&lt;MD5&gt;.&lt;file extension&gt;</strong></p><p name="d8ce" id="d8ce" class="graf graf--p graf-after--p">To grab you shell don’t forget to start your listener.Browsing to the URL <br><strong class="markup--strong markup--p-strong">http://10.10.10.121/support/uploads/tickets/04215397f1a751cf60d7e42fc06a6767.php</strong></p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="0e8a" id="0e8a" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 191px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 18.5%;"></div><img class="graf-image" data-image-id="1*bXyP3mYQRq4SKrkWcisTmg.png" data-width="1775" data-height="329" src="https://cdn-images-1.medium.com/max/1200/1*bXyP3mYQRq4SKrkWcisTmg.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="a19a" id="a19a" class="graf graf--p graf-after--figure">Banggg!! Got shell.</p><h3 name="f2dd" id="f2dd" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">Privelege Escalation</strong></h3><p name="f7bb" id="f7bb" class="graf graf--p graf-after--h3">Looking at the directories manually, I couldn’t find anything of great interest. Also running <a href="https://gist.github.com/jsvazic/8fe9dde369f6396f65a1aa795dd77744" data-href="https://gist.github.com/jsvazic/8fe9dde369f6396f65a1aa795dd77744" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">procmon.sh ( Ippsec Process Monitoring script )</strong></a><strong class="markup--strong markup--p-strong"> </strong>went in vain.</p><figure name="c660" id="c660" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/jsvazic/8fe9dde369f6396f65a1aa795dd77744.js"></script></figure><p name="8e52" id="8e52" class="graf graf--p graf-after--figure">As usual, I ran <a href="https://github.com/rebootuser/LinEnum" data-href="https://github.com/rebootuser/LinEnum" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">LinEnum</strong></a> and didn’t see anything fishy there too. But, the kernel was old. I didn’t consider the option of using kernel exploit as more often than not it is not the intended way to priv esc . As I had no other option, I went forward with kernel exploit. Have a look at the kernel version below.</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="d061" id="d061" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1032px; max-height: 113px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 11%;"></div><img class="graf-image" data-image-id="1*TDu3cauIkealKDFbCdhcWw.png" data-width="1835" data-height="201" src="https://cdn-images-1.medium.com/max/1200/1*TDu3cauIkealKDFbCdhcWw.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="f907" id="f907" class="graf graf--p graf-after--figure"><a href="https://www.exploit-db.com/exploits/44298" data-href="https://www.exploit-db.com/exploits/44298" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">A quick google search</a>, showed an privilege escalation exploit. Lets run the exploit there and get rooot shell.</p><figure name="4194" id="4194" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 680px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 97.2%;"></div><img class="graf-image" data-image-id="1*1NuuuRO3VSBnYHl5rBHKGQ.png" data-width="889" data-height="864" src="https://cdn-images-1.medium.com/max/800/1*1NuuuRO3VSBnYHl5rBHKGQ.png"></div></figure><p name="35af" id="35af" class="graf graf--p graf-after--figure">Rooted and done. Go get your flags if you haven’t still.</p><h3 name="3c70" id="3c70" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">Additional</strong></h3><h4 name="e163" id="e163" class="graf graf--h4 graf-after--h3">Port 3000 — Node.js Express Framework</h4><p name="3f18" id="3f18" class="graf graf--p graf-after--h4">Checking the 3000 port, we are greeted with an JSON response.</p><figure name="d90b" id="d90b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 94px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 13.4%;"></div><img class="graf-image" data-image-id="1*obgyDgzZJwyvc1fnYkiDhQ.png" data-width="1082" data-height="145" src="https://cdn-images-1.medium.com/max/800/1*obgyDgzZJwyvc1fnYkiDhQ.png"></div></figure><p name="79fd" id="79fd" class="graf graf--p graf-after--figure">Well, may be we got an potential username <strong class="markup--strong markup--p-strong">( Shiv )</strong>. Lets put it in our backpocket and enumerate more.</p><p name="28c1" id="28c1" class="graf graf--p graf-after--p">Page says, we have to get the creds with given query. What’s the query heh!!?Friend of mine told me that its using <strong class="markup--strong markup--p-strong">GRAPHQL</strong>, an alternative to <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" data-href="https://en.wikipedia.org/wiki/Representational_state_transfer" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">REST</strong></a>. And the endpoint in GraphQL is <strong class="markup--strong markup--p-strong">/graphql</strong></p><h4 name="2fdb" id="2fdb" class="graf graf--h4 graf-after--p">And the URL is http://&lt;site&gt;/graphql?query={query}</h4><p name="4f66" id="4f66" class="graf graf--p graf-after--h4">After a lot of trial and error method. I managed to get the correct query.</p><p name="6d17" id="6d17" class="graf graf--p graf-after--p"><a href="http://10.10.10.121:3000/graphql?query=%7Buser%7Busername,password" data-href="http://10.10.10.121:3000/graphql?query={user{username,password" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank"><strong class="markup--strong markup--p-strong">http://10.10.10.121:3000/graphql?query={user{username,password</strong></a><strong class="markup--strong markup--p-strong">}}</strong></p><figure name="94e6" id="94e6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 232px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33.1%;"></div><img class="graf-image" data-image-id="1*frdisNop_jU6VplpyKjmZw.png" data-width="908" data-height="301" src="https://cdn-images-1.medium.com/max/800/1*frdisNop_jU6VplpyKjmZw.png"></div></figure><p name="17ef" id="17ef" class="graf graf--p graf-after--figure">Use these creds( after cracking the hash,of course ) to login to HelpDeskz application and rest everything is same. There are exploits for the same in the wild, they need some editing though, I will leave them upto you to try them out.</p><p name="2142" id="2142" class="graf graf--p graf-after--p">This is my first writeup. Feel free to submit any feedback and if you liked it don’t forget to give it a clap.</p><p name="f0fe" id="f0fe" class="graf graf--p graf-after--p graf--trailing"><strong class="markup--strong markup--p-strong">Thanks and Happy Hacking,<br>Preetham (</strong><a href="https://www.hackthebox.eu/profile/9160" data-href="https://www.hackthebox.eu/profile/9160" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">@cyber01</em></strong></a><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> </em>)</strong></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@preethambomma" class="p-author h-card">Preetham Bomma</a> on <a href="https://medium.com/p/20ef0acb6d82"><time class="dt-published" datetime="2019-06-08T15:05:22.158Z">June 8, 2019</time></a>.</p><p><a href="https://medium.com/@preethambomma/help-hackthebox-writeup-20ef0acb6d82" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on June 22, 2019.</p></footer></article></body></html>